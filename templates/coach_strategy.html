{% extends "base.html" %}

{% block title %}Coaching Strategy{% endblock %}

{% block content %}
<style>
    /* Page Specific Styles */
    .strategy-container { max-width: 1000px; margin: 0 auto; padding: 20px; }
    
    .page-header { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        border-bottom: 1px solid #e2e8f0; 
        padding-bottom: 20px; 
        margin-bottom: 30px; 
    }

    .page-title {
        font-size: 24px;
        font-weight: 800;
        color: var(--text-primary, #333);
        margin: 0;
    }
    
    .strategy-section { 
        background: #fff; 
        border: 1px solid #e2e8f0; 
        border-radius: 12px; 
        padding: 40px; 
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); 
    }
    
    .settings-group { padding: 30px 0; border-bottom: 1px solid #eee; }
    .settings-group:last-child { border-bottom: none; }
    
    .group-title { font-size: 1.5rem; color: #1e293b; margin: 0 0 10px 0; font-weight: 700; }
    .group-description { color: #64748b; margin-bottom: 25px; }
    
    .settings-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; }
    .setting-item { display: flex; flex-direction: column; }
    .setting-label { font-weight: 600; margin-bottom: 8px; color: #334155; }
    
    .setting-select { 
        padding: 10px 12px; 
        border-radius: 8px; 
        border: 1px solid #cbd5e1; 
        background: #f8fafc; 
        font-size: 14px; 
        color: #0f172a;
    }
    .setting-select:focus { border-color: #3b82f6; outline: none; }
    
    .setting-help { font-size: 12px; color: #94a3b8; margin-top: 6px; font-style: italic; }
    
    .save-button { 
        background: #10b981; 
        color: #fff; 
        font-weight: 700; 
        border: none; 
        padding: 15px 50px; 
        border-radius: 8px; 
        cursor: pointer; 
        display: block; 
        margin: 30px auto 0; 
        font-size: 16px; 
        transition: background 0.2s;
    }
    .save-button:hover { background: #059669; }
    .save-button:disabled { background: #9ca3af; cursor: not-allowed; }
    
    .alert-box { 
        padding: 15px; 
        border-radius: 8px; 
        margin-bottom: 20px; 
        text-align: center; 
        display: none; 
        font-weight: 600; 
    }
    .alert-success { background: #d1fae5; color: #065f46; border: 1px solid #34d399; }
    .alert-error { background: #fee2e2; color: #991b1b; border: 1px solid #f87171; }
</style>

<div class="strategy-container">
    <div class="page-header">
        <h1 class="page-title">Coaching Strategy</h1>
    </div>

    <div id="statusMessage" class="alert-box"></div>

    <div class="strategy-section">
        <form id="strategyForm" onsubmit="saveStrategy(event)">
            
            <div class="settings-group">
                <h2 class="group-title">Game Plan</h2>
                <p class="group-description">Dictate your team's tactical approach on both ends of the floor.</p>
                <div class="settings-grid">
                    <div class="setting-item">
                        <label class="setting-label">Offensive Focus</label>
                        <select name="offense_focus" class="setting-select">
                            <option value="balanced" {% if strategy and strategy.offense_focus == 'balanced' %}selected{% endif %}>Balanced</option>
                            <option value="3pt" {% if strategy and strategy.offense_focus == '3pt' %}selected{% endif %}>Prioritize 3-Point Shooting</option>
                            <option value="paint" {% if strategy and strategy.offense_focus == 'paint' %}selected{% endif %}>Attack the Paint</option>
                            <option value="pace" {% if strategy and strategy.offense_focus == 'pace' %}selected{% endif %}>Fast Pace / Transition</option>
                            <option value="slow" {% if strategy and strategy.offense_focus == 'slow' %}selected{% endif %}>Slow Pace / Half-Court</option>
                        </select>
                        <p class="setting-help">Determines shot selection and tempo.</p>
                    </div>

                    <div class="setting-item">
                        <label class="setting-label">Defensive Focus</label>
                        <select name="defense_focus" class="setting-select">
                            <option value="balanced" {% if strategy and strategy.defense_focus == 'balanced' %}selected{% endif %}>Balanced</option>
                            <option value="pressure" {% if strategy and strategy.defense_focus == 'pressure' %}selected{% endif %}>High Pressure / Steals</option>
                            <option value="paint" {% if strategy and strategy.defense_focus == 'paint' %}selected{% endif %}>Protect Paint (Drop Coverage)</option>
                            <option value="perimeter" {% if strategy and strategy.defense_focus == 'perimeter' %}selected{% endif %}>Perimeter Defense (Switching)</option>
                        </select>
                        <p class="setting-help">Determines defensive aggression and coverage.</p>
                    </div>
                </div>
            </div>

            <div class="settings-group">
                <h2 class="group-title">Rotation & Development</h2>
                <p class="group-description">Manage player minutes and development priorities.</p>
                <div class="settings-grid">
                    <div class="setting-item">
                        <label class="setting-label">Bench Minutes</label>
                        <select name="bench_minutes" class="setting-select">
                            <option value="normal" {% if strategy and strategy.bench_minutes == 'normal' %}selected{% endif %}>Normal Rotation</option>
                            <option value="heavy" {% if strategy and strategy.bench_minutes == 'heavy' %}selected{% endif %}>Ride Starters (Heavy Mins)</option>
                            <option value="deep" {% if strategy and strategy.bench_minutes == 'deep' %}selected{% endif %}>Deep Bench (10+ Players)</option>
                            <option value="load_manage" {% if strategy and strategy.bench_minutes == 'load_manage' %}selected{% endif %}>Load Management</option>
                        </select>
                        <p class="setting-help">Controls how often the bench is utilized.</p>
                    </div>

                    <div class="setting-item">
                        <label class="setting-label">Training Focus</label>
                        <select name="training_focus" class="setting-select">
                            <option value="shooting" {% if strategy and strategy.training_focus == 'shooting' %}selected{% endif %}>Shooting & Scoring</option>
                            <option value="defense" {% if strategy and strategy.training_focus == 'defense' %}selected{% endif %}>Defensive IQ</option>
                            <option value="playmaking" {% if strategy and strategy.training_focus == 'playmaking' %}selected{% endif %}>Playmaking & Passing</option>
                            <option value="strength" {% if strategy and strategy.training_focus == 'strength' %}selected{% endif %}>Strength & Conditioning</option>
                        </select>
                        <p class="setting-help">Boosts specific attributes during the season.</p>
                    </div>
                </div>
            </div>

            <button type="submit" class="save-button">ðŸ’¾ Save Strategy</button>
        </form>
    </div>
</div>

<script>
    function saveStrategy(event) {
        event.preventDefault();
        const formData = new FormData(event.target);
        const strategy = Object.fromEntries(formData.entries());
        
        const btn = document.querySelector('.save-button');
        const msg = document.getElementById('statusMessage');
        
        btn.disabled = true;
        btn.textContent = 'Saving...';
        msg.style.display = 'none';
        msg.className = 'alert-box';

        fetch('/save_strategy', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(strategy)
        })
        .then(res => {
            if (!res.ok) { throw new Error(`Server returned error ${res.status}`); }
            return res.json();
        })
        .then(data => {
            if(data.success) {
                msg.textContent = 'âœ“ Strategy settings saved successfully!';
                msg.classList.add('alert-success');
                msg.style.display = 'block';
                setTimeout(() => { msg.style.display = 'none'; }, 3000);
            } else {
                throw new Error('Database save failed');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            msg.textContent = 'âš  Error: ' + error.message;
            msg.classList.add('alert-error');
            msg.style.display = 'block';
        })
        .finally(() => {
            btn.disabled = false;
            btn.textContent = 'ðŸ’¾ Save Strategy';
        });
    }
</script>
{% endblock %}